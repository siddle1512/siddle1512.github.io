import{j as e,P as h,G as Se,T as A,B as Ne,r as u,R as Te,H as be,I,J as Qe,M as re,w as b,a2 as Le,A as k,K as T,N as Be,O as Re,v as ze,Q as Oe,S as Ve,C as _e,Z as Me,V as We,t as je,W as He}from"./index-98796e33.js";import{u as ge,w as Ge}from"./xlsx-f5126985.js";import{T as D,a as c,b as we,C as Ie,c as Je,d as ye,e as Ce,f as se,g as Ue}from"./TableSortLabel-9403fd01.js";import{L as Ke}from"./label-8863b2a1.js";import{D as _,a as M,b as W,c as H}from"./DialogTitle-61df68e4.js";import{C as Ye}from"./Container-00550331.js";import{A as ve}from"./Autocomplete-16110deb.js";import"./Close-8a09979b.js";function De({emptyRows:s,height:i}){return s?e.jsx(D,{sx:{...i&&{height:i*s}},children:e.jsx(c,{colSpan:9})}):null}De.propTypes={emptyRows:h.number,height:h.number};function Pe({query:s}){return e.jsx(D,{children:e.jsx(c,{align:"center",colSpan:6,sx:{py:3},children:e.jsxs(Se,{sx:{textAlign:"center"},children:[e.jsx(A,{variant:"h6",paragraph:!0,children:"Not found"}),e.jsxs(A,{variant:"body2",children:["No results found for  ",e.jsxs("strong",{children:['"',s,'"']}),".",e.jsx("br",{})," Try checking for typos or using complete words."]})]})})})}Pe.propTypes={query:h.string};const Ze={border:0,margin:-1,padding:0,width:"1px",height:"1px",overflow:"hidden",position:"absolute",whiteSpace:"nowrap",clip:"rect(0 0 0 0)"};function Xe(s,i,d){return s?Math.max(0,(1+s)*i-d):0}function ke(s,i,d){const g=d.split(".");let a=s,p=i;for(let x=0;x<g.length;x+=1){const w=g[x];a=a[w],p=p[w]}return a===null?1:p===null||p<a?-1:p>a?1:0}function et(s,i){return s==="desc"?(d,g)=>ke(d,g,i):(d,g)=>-ke(d,g,i)}function tt({inputData:s,comparator:i,filterName:d}){const g=s.map((a,p)=>[a,p]);return g.sort((a,p)=>{const x=i(a[0],p[0]);return x!==0?x:a[1]-p[1]}),s=g.map(a=>a[0]),d&&(s=s.filter(a=>a.customer.name.toLowerCase().indexOf(d.toLowerCase())!==-1)),s}function $e({order:s,orderBy:i,rowCount:d,headLabel:g,numSelected:a,onRequestSort:p,onSelectAllClick:x}){const w=m=>P=>{p(P,m)};return e.jsx(we,{children:e.jsxs(D,{children:[e.jsx(c,{padding:"checkbox",children:e.jsx(Ie,{indeterminate:a>0&&a<d,checked:d>0&&a===d,onChange:x})}),g.map(m=>e.jsx(c,{align:m.align||"left",sortDirection:i===m.id?s:!1,sx:{width:m.width,minWidth:m.minWidth},children:e.jsxs(Je,{hideSortIcon:!0,active:i===m.id,direction:i===m.id?s:"asc",onClick:w(m.id),children:[m.label,i===m.id?e.jsx(Ne,{sx:{...Ze},children:s==="desc"?"sorted descending":"sorted ascending"}):null]})},m.id))]})})}$e.propTypes={order:h.oneOf(["asc","desc"]),orderBy:h.string,rowCount:h.number,headLabel:h.array,numSelected:h.number,onRequestSort:h.func,onSelectAllClick:h.func};function Ae({id:s,selected:i,name:d,type:g,price:a,createAt:p,status:x,handleClick:w,updateQuotationStatus:m,fetchQuotations:P}){const[v,G]=u.useState(null);Te();const[ae,ce]=u.useState(!1),[ie,O]=u.useState(!1),[N,R]=u.useState(!1),[J,F]=u.useState(!1),[U,C]=u.useState(null),[q,K]=u.useState(!1),[$,le]=u.useState(0),de=l=>{ee(l),K(!0)},Y=()=>{K(!1),S()},ue=()=>{ce(!0)},Q=()=>{ce(!1),S()},he=()=>{R(!0)},L=()=>{R(!1),S()},pe=()=>{O(!0)},z=()=>{O(!1),S()},Z=l=>{G(l.currentTarget)},S=()=>{G(null)},xe=async l=>{try{const y=localStorage.getItem("jwttoken");(await fetch(`${k}/api/Orders/${l}/confirm`,{method:"PUT",headers:{Authorization:`Bearer ${y}`,"Content-Type":"application/json"}})).ok?(console.log("Orders confirmed successfully."),m(l,"Fully Invoice"),P(),L(),S(),T.fire({title:"Confirmed!",text:"Confirm Orders successfully!",icon:"success"})):(console.error("Failed to confirm Orders."),S(),T.fire({icon:"error",title:"Failed!",text:"Failed to confirm Orders!"}))}catch(y){console.error("Error confirming Orders:",y)}},X=async l=>{try{const y=localStorage.getItem("jwttoken");(await fetch(`${k}/api/Quotation/${l}/cancel`,{method:"PUT",headers:{Authorization:`Bearer ${y}`,"Content-Type":"application/json"}})).ok?(console.log("Orders canceled successfully."),m(l,"Cancelled"),P(),z(),S(),T.fire({title:"Canceled!",text:"Cancel Orders successfully!",icon:"success"})):(console.error("Failed to cancel Orders."),S(),T.fire({icon:"error",title:"Failed!",text:"Failed to cancel Orders!"}))}catch(y){console.error("Error canceling Orders:",y)}},ee=async l=>{try{const y=localStorage.getItem("jwttoken"),E=await fetch(`${k}/api/Orders/${l}`,{headers:{Authorization:`Bearer ${y}`}});if(E.ok){const te=await E.json();C(te);const fe=te.reduce((oe,me)=>oe+me.subTotal,0);le(fe)}else console.error("Failed to fetch Orders details")}catch(y){throw console.error("Error fetching Orders details:",y),y}},B=async l=>{try{F(!0);const y=localStorage.getItem("jwttoken");(await fetch(`${k}/api/Orders/${l}/SendOrderEmail`,{method:"POST",headers:{Authorization:`Bearer ${y}`,"Content-Type":"application/json"},body:JSON.stringify({quotationId:l})})).ok?(console.log("Orders email sent successfully."),F(!1),Q(),S(),T.fire({title:"Email Sent!",text:"Orders email sent successfully!",icon:"success"})):(console.error("Failed to send Orders email."),Q(),S(),T.fire({icon:"error",title:"Failed!",text:"Failed to send Orders email!"}))}catch(y){console.error("Error sending Orders email:",y)}};return e.jsxs(e.Fragment,{children:[e.jsxs(D,{hover:!0,tabIndex:-1,role:"checkbox",selected:i,children:[e.jsx(c,{padding:"checkbox",children:e.jsx(Ie,{disableRipple:!0,checked:i,onChange:w})}),e.jsx(c,{children:e.jsx(A,{variant:"subtitle2",noWrap:!0,children:d})}),e.jsx(c,{children:(()=>{let l="primary";return x==="Cancelled"?l="error":x==="To Invoice"?l="warning":x==="Fully Invoice"&&(l="success"),e.jsx(Ke,{color:l,children:x})})()}),e.jsx(c,{children:ot(p)}),e.jsx(c,{children:a.toLocaleString("vi-VN",{style:"currency",currency:"VND"})}),e.jsx(c,{align:"right",children:e.jsx(be,{onClick:Z,children:e.jsx(I,{icon:"eva:more-vertical-fill"})})})]}),e.jsxs(Qe,{open:!!v,anchorEl:v,onClose:S,anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"right"},PaperProps:{sx:{width:140}},children:[e.jsxs(re,{onClick:()=>de(s),sx:{color:"warning.main"},children:[e.jsx(I,{icon:"eva-info-fill",sx:{mr:2}}),"Detail"]}),e.jsxs(_,{open:q,onClose:Y,children:[e.jsx(M,{children:"Orders Detail"}),e.jsx(W,{children:U&&e.jsx(e.Fragment,{children:e.jsx(ye,{component:Se,children:e.jsxs(Ce,{children:[e.jsx(we,{children:e.jsxs(D,{children:[e.jsx(c,{children:"Product"}),e.jsx(c,{children:"Quantity"}),e.jsx(c,{children:"SubTotal"}),e.jsx(c,{children:"Tax"})]})}),e.jsx(se,{children:U.map(l=>e.jsxs(D,{children:[e.jsx(c,{children:l.product.name}),e.jsx(c,{children:l.quantity}),e.jsxs(c,{children:[l.subTotal,"VNĐ"]}),e.jsxs(c,{children:[l.product.tax*100,"%"]})]},l.id))}),e.jsx(se,{children:e.jsxs(D,{children:[e.jsx(c,{colSpan:2,className:"text-right",children:e.jsx(A,{variant:"strong",children:"Total:"})}),e.jsxs(c,{children:[$,"VNĐ"]})]})})]})})})}),e.jsx(H,{children:e.jsx(b,{onClick:Y,variant:"outlined",color:"primary",children:"Close"})})]}),x==="To Invoice"&&e.jsxs(re,{onClick:he,sx:{color:"success.main"},children:[e.jsx(I,{icon:"eva:edit-fill",sx:{mr:2}}),"Confirm"]}),e.jsxs(_,{open:N,onClose:L,children:[e.jsx(M,{children:"Confirm"}),e.jsx(W,{children:"Are you sure you want to confirm this quotation?"}),e.jsxs(H,{children:[e.jsx(b,{onClick:L,variant:"outlined",color:"primary",children:"Leave"}),e.jsx(b,{onClick:()=>xe(s),variant:"contained",color:"success",children:"Confirm"})]})]}),x==="To Invoice"&&e.jsxs(re,{onClick:ue,sx:{color:"primary.main"},children:[e.jsx(I,{icon:"eva-navigation-2-fill",sx:{mr:2}}),"Send"]}),e.jsxs(_,{open:ae,onClose:Q,children:[e.jsx(M,{children:"Send"}),e.jsx(W,{children:"Are you sure you want to send this Orders?"}),e.jsxs(H,{children:[e.jsx(b,{onClick:Q,variant:"outlined",color:"primary",children:"Leave"}),e.jsxs(b,{onClick:()=>B(s),variant:"contained",color:"primary",disabled:J,children:[J&&e.jsx(Le,{size:24,sx:{position:"absolute",left:"50%",top:"50%",marginLeft:"-12px",marginTop:"-12px"}}),"Send"]})]})]}),x==="To Invoice"&&e.jsxs(re,{onClick:pe,sx:{color:"error.main"},children:[e.jsx(I,{icon:"eva-close-square-outline",sx:{mr:2}}),"Cancel"]}),e.jsxs(_,{open:ie,onClose:z,children:[e.jsx(M,{children:"Cancel"}),e.jsx(W,{children:"Are you sure you want to cancel this Orders?"}),e.jsxs(H,{children:[e.jsx(b,{onClick:z,variant:"outlined",color:"primary",children:"Leave"}),e.jsx(b,{onClick:()=>X(s),variant:"contained",color:"error",children:"Cancel"})]})]})]})]})}Ae.propTypes={id:h.number,selected:h.bool,name:h.string,type:h.string,price:h.number,createAt:h.string,status:h.string,handleClick:h.func,updateQuotationStatus:h.func,fetchQuotations:h.func};function ot(s){const i=new Date(s),d=i.getDate(),g=i.getMonth()+1,a=i.getFullYear(),p=i.getHours(),x=i.getMinutes(),w=d<10?`0${d}`:d,m=g<10?`0${g}`:g,P=p<10?`0${p}`:p,v=x<10?`0${x}`:x;return`${w}/${m}/${a} (${P}:${v})`}function Fe({numSelected:s,filterName:i,onFilterName:d,onDelete:g,onExportToExcel:a}){return u.useState(!1),e.jsxs(Be,{sx:{height:96,display:"flex",justifyContent:"space-between",p:p=>p.spacing(0,1,0,3),...s>0&&{color:"primary.main",bgcolor:"primary.lighter"}},children:[s>0?e.jsxs(A,{component:"div",variant:"subtitle1",children:[s," selected"]}):e.jsx(Re,{value:i,onChange:d,placeholder:"Search Quotaion...",startAdornment:e.jsx(ze,{position:"start",children:e.jsx(I,{icon:"eva:search-fill",sx:{color:"text.disabled",width:20,height:20}})})}),s>0&&e.jsx(Oe,{title:"Export to Excel",children:e.jsx(be,{onClick:a,children:e.jsx(I,{icon:"eva-save-fill"})})})]})}Fe.propTypes={numSelected:h.number,filterName:h.string,onFilterName:h.func,onDelete:h.func,onExportToExcel:h.func.isRequired};function nt(){const[s,i]=u.useState(0),[d,g]=u.useState("asc"),[a,p]=u.useState([]),[x,w]=u.useState("name"),[m,P]=u.useState(""),[v,G]=u.useState(5),ae=Te();u.useRef(!0);const[ce,ie]=u.useState(!1),[O,N]=u.useState([]),[R,J]=u.useState([]),[F,U]=u.useState([]);u.useState(!1);const[C,q]=u.useState({customerId:"",products:[{productId:"",quantity:1,subtotal:0}]}),[K,$]=u.useState(!1);u.useState(null),u.useState(0),u.useEffect(()=>{const t=async()=>{try{const r=localStorage.getItem("jwttoken"),f=await fetch(`${k}/api/Orders/orders`,{headers:{Authorization:`Bearer ${r}`}});if(f.ok){const j=await f.json();console.log(j),N(j)}else console.error("Failed to fetch quotations")}catch(r){console.error("Error fetching quotations:",r)}},n=async()=>{try{const r=localStorage.getItem("jwttoken"),f=await fetch(`${k}/api/Customer/GetCustomer`,{headers:{Authorization:`Bearer ${r}`}});if(f.ok){const j=await f.json();console.log(j),J(j)}else console.error("Failed to fetch customers")}catch(r){console.error("Error fetching customers:",r)}},o=async()=>{try{const r=localStorage.getItem("jwttoken"),f=await fetch(`${k}/api/Product`,{headers:{Authorization:`Bearer ${r}`}});if(f.ok){const j=await f.json();console.log(j),U(j)}else console.error("Failed to fetch products")}catch(r){console.error("Error fetching products:",r)}};t(),n(),o()},[ae]);const le=(t,n)=>{n!==""&&(g(x===n&&d==="asc"?"desc":"asc"),w(n))},de=t=>{if(t.target.checked){const n=O.map(o=>o.id);p(n);return}p([])},Y=(t,n)=>{const o=a.indexOf(n);let r=[];o===-1?r=r.concat(a,n):o===0?r=r.concat(a.slice(1)):o===a.length-1?r=r.concat(a.slice(0,-1)):o>0&&(r=r.concat(a.slice(0,o),a.slice(o+1))),p(r)},ue=(t,n)=>{i(n)},Q=t=>{i(0),G(parseInt(t.target.value,10))},he=t=>{i(0),P(t.target.value)},L=tt({inputData:O,comparator:et(d,x),filterName:m}),pe=!L.length&&!!m,z=(t,n)=>{N(o=>o.map(r=>r.id===t?{...r,status:n}:r))},Z=async()=>{try{const t=localStorage.getItem("jwttoken"),n=await fetch(`${k}/api/Orders/orders`,{headers:{Authorization:`Bearer ${t}`}});if(n.ok){const o=await n.json();console.log(o),N(o)}else console.error("Failed to fetch quotations")}catch(t){console.error("Error fetching quotations:",t)}},S=async()=>{if(!C.customerId||!C.products.some(o=>o.productId)){console.error("Invalid quotation. CustomerId and at least one product are required."),$(!1),T.fire({icon:"error",title:"Oops...",text:"Invalid quotation!"});return}const t=new Set;if(C.products.some(o=>t.has(o.productId)?!0:(t.add(o.productId),!1))){console.error("Invalid quotation. Duplicate products are not allowed."),$(!1),T.fire({icon:"error",title:"Oops...",text:"Duplicate products are not allowed!"});return}try{const o=localStorage.getItem("jwttoken"),r=await fetch(`${k}/api/Orders`,{method:"POST",headers:{Authorization:`Bearer ${o}`,"Content-Type":"application/json"},body:JSON.stringify({customerId:C.customerId,products:C.products})});if(r.ok){const f=await r.json();N(j=>[...j,f]),Z(),$(!1),T.fire({title:"Added!",text:"Addquotation successfully!",icon:"success"})}else{const f=await r.text();console.error("Failed to create quotation:",f),$(!1),T.fire({icon:"error",title:"Oops...",text:"Failed to create quotation!"})}}catch(o){console.error("Error creating quotation:",o)}q({customerId:"",products:[{productId:"",quantity:1}]}),ie(!1)},xe=()=>{$(!0)},X=()=>{$(!1)},ee=(t,n)=>{const o=B(t);return(n*o).toLocaleString("vi-VN",{style:"currency",currency:"VND"})},B=t=>{const n=F.find(o=>o.id===t);return n?n.price:0},l=t=>{q(n=>{const o=[...n.products];return o.splice(t,1),{...n,products:o}})},y=(t,n,o)=>{q(r=>{const f=r.products.map((j,V)=>V===t?{...j,[n]:o,subtotal:ee(j.productId,o)}:j);return{...r,products:f}})},E=()=>{q(t=>({...t,products:[...t.products,{productId:"",quantity:1,subtotal:0}]}))},te=()=>C.products.reduce((n,o)=>{const f=B(o.productId)*o.quantity;return n+f},0).toLocaleString("vi-VN",{style:"currency",currency:"VND"}),fe=()=>C.products.reduce((n,o)=>{const r=B(o.productId),f=oe(o.productId),j=r*(1+f)*o.quantity;return n+j},0).toLocaleString("vi-VN",{style:"currency",currency:"VND"}),oe=t=>{const n=F.find(o=>o.id===t);return n?n.tax:0},me=async()=>{const t=ge.book_new(),n=[];await Promise.all(a.map(async r=>{const f=O.find(V=>V.id===r),j=await qe(r);if(f&&j&&j.length>0){const V={Customer:f.customer.name,Status:f.status,CreateAt:f.createdAt,Total:f.total},Ee=j.map(ne=>({Product:ne.product.name,Quantity:ne.quantity,Subtotal:ne.subTotal,Tax:ne.product.tax}));n.push(V,...Ee)}else console.error(`Failed to fetch quotation details for ID ${r}`)}));const o=ge.json_to_sheet(n);ge.book_append_sheet(t,o,"Quotations_With_Details"),Ge(t,"selected_quotations_with_details.xlsx")},qe=async t=>{try{const n=localStorage.getItem("jwttoken"),o=await fetch(`${k}/api/Quotation/${t}`,{headers:{Authorization:`Bearer ${n}`}});if(o.ok)return await o.json();console.error(`Failed to fetch quotation details for ID ${t}`)}catch(n){console.error("Error fetching quotation details:",n)}return[]};return e.jsxs(Ye,{children:[e.jsxs(Ve,{direction:"row",alignItems:"center",justifyContent:"space-between",mb:5,children:[e.jsx(A,{variant:"h4",children:"Orders"}),e.jsx(b,{onClick:xe,variant:"contained",color:"inherit",startIcon:e.jsx(I,{icon:"eva:plus-fill"}),children:"New Order"})]}),e.jsxs(_e,{children:[e.jsx(Fe,{numSelected:a.length,filterName:m,onFilterName:he,onExportToExcel:me}),e.jsx(Me,{children:e.jsx(ye,{sx:{overflow:"unset"},children:e.jsxs(Ce,{sx:{minWidth:800},children:[e.jsx($e,{order:d,orderBy:x,rowCount:O.length,numSelected:a.length,onRequestSort:le,onSelectAllClick:de,headLabel:[{id:"customer.name",label:"Customer"},{id:"status",label:"Status"},{id:"createAt",label:"CreateAt"},{id:"price",label:"Total($)"},{id:""}]}),e.jsxs(se,{children:[L.slice(s*v,s*v+v).map(t=>e.jsx(Ae,{id:t.id,name:t.customer.name,status:t.status,createAt:t.createdAt,price:t.total,updateQuotationStatus:z,selected:a.indexOf(t.id)!==-1,handleClick:n=>Y(n,t.id),fetchQuotations:Z},t.id)),e.jsx(De,{height:77,emptyRows:Xe(s,v,O.length)}),pe&&e.jsx(Pe,{query:m})]})]})})}),e.jsx(Ue,{page:s,component:"div",count:O.length,rowsPerPage:v,onPageChange:ue,rowsPerPageOptions:[5,10,25],onRowsPerPageChange:Q})]}),e.jsxs(_,{open:K,onClose:X,maxWidth:"md",fullWidth:!0,children:[e.jsx(M,{children:"Create Orders"}),e.jsxs(W,{children:[e.jsx(We,{fullWidth:!0,variant:"outlined",margin:"dense",children:e.jsx(ve,{options:R,getOptionLabel:t=>t.name,value:C.customerId?R.find(t=>t.id===C.customerId):null,onChange:(t,n)=>{q({...C,customerId:n?n.id:""})},renderInput:t=>e.jsx(je,{...t,label:"Customer",variant:"outlined"})})}),e.jsx(ye,{component:Se,style:{marginTop:"16px"},children:e.jsxs(Ce,{children:[e.jsx(we,{children:e.jsxs(D,{children:[e.jsx(c,{children:"Product"}),e.jsx(c,{children:"Price($)"}),e.jsx(c,{children:"Quantity"}),e.jsx(c,{children:"SubTotal($)"}),e.jsx(c,{children:"Tax"}),e.jsx(c,{children:"Action"})]})}),e.jsx(se,{children:C.products.map((t,n)=>e.jsxs(D,{children:[e.jsx(c,{children:e.jsx(ve,{options:F,getOptionLabel:o=>o.name,value:t.productId?F.find(o=>o.id===t.productId):null,onChange:(o,r)=>{y(n,"productId",r?r.id:"")},renderInput:o=>e.jsx(je,{...o,label:"Product",variant:"outlined"})})}),e.jsx(c,{children:`${B(t.productId).toLocaleString("vi-VN",{style:"currency",currency:"VND"})}`}),e.jsx(c,{children:e.jsx(je,{type:"number",min:"1",value:t.quantity,onChange:o=>y(n,"quantity",o.target.value),variant:"outlined",style:{width:"80px"}})}),e.jsx(c,{children:`${ee(t.productId,t.quantity)}`}),e.jsx(c,{children:`${oe(t.productId)*100}%`}),e.jsx(c,{onClick:()=>l(n),children:e.jsx(Oe,{title:"Cancel",children:e.jsx(be,{children:e.jsx(I,{icon:"eva-close-fill"})})})})]},n))})]})}),e.jsx(b,{variant:"outlined",color:"primary",onClick:E,style:{marginTop:"8px"},children:"More"})]}),e.jsxs(H,{children:[e.jsxs("div",{style:{flexGrow:1,marginLeft:"16px"},children:[e.jsx(A,{variant:"body1",children:`Total without tax: ${te()}`}),e.jsx(A,{variant:"body1",children:`Total with tax: ${fe()}`})]}),e.jsx(b,{onClick:X,variant:"outlined",color:"primary",children:"Cancel"}),e.jsx(b,{variant:"contained",color:"success",onClick:S,children:"Add"})]})]})]})}function ht(){return e.jsxs(e.Fragment,{children:[e.jsx(He,{children:e.jsx("title",{children:" Orders | SaleBook "})}),e.jsx(nt,{})]})}export{ht as default};
